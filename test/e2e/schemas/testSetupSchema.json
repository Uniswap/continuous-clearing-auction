{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "testSetupSchema",
  "title": "Auction Test Setup Schema",
  "type": "object",
  "additionalProperties": true,
  "required": ["env", "auctionParameters", "additionalTokens"],
  "properties": {
    "env": {
      "type": "object",
      "additionalProperties": false,
      "required": ["startBlock"],
      "properties": {
        "chainId": { "type": "integer", "enum": [1, 5, 11155111, 42161, 8453, 31337] },
        "startBlock": { "$ref": "#/$defs/U64" },
        "blockTimeSec": { "type": "integer", "minimum": 0 },
        "blockGasLimit": { "$ref": "#/$defs/U256", "default": "30000000" },
        "txGasLimit": { "$ref": "#/$defs/U256", "default": "30000000" },
        "baseFeePerGasWei": { "$ref": "#/$defs/U256", "default": "0" },
        "fork": {
          "type": "object",
          "additionalProperties": false,
          "required": ["rpcUrl", "blockNumber"],
          "properties": {
            "rpcUrl": { "type": "string", "format": "uri" },
            "blockNumber": { "$ref": "#/$defs/U64" }
          }
        },
        "balances": {
          "type": "array",
          "items": { "$ref": "#/$defs/BalanceItem" }
        }
      }
    },
    "auctionParameters": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "currency",
        "auctionedToken",
        "tokensRecipient",
        "fundsRecipient",
        "startOffsetBlocks",
        "auctionDurationBlocks",
        "claimDelayBlocks",
        "graduationThresholdMps",
        "tickSpacing",
        "validationHook",
        "floorPrice"
      ],
      "properties": {
        "currency": { 
          "oneOf": [
            { "$ref": "#/$defs/Address" },
            { "type": "string", "const": "Native" },
            { "type": "string", "minLength": 1, "pattern": "^[A-Za-z][A-Za-z0-9_]*$", "not": { "const": "Native" } }
          ],
          "description": "Either an address, 'Native' for native currency (ETH, MATIC, BNB, etc.), or a token name reference"
        },
        "auctionedToken": { 
          "type": "string", 
          "minLength": 1,
          "description": "Name of the token being auctioned (must exist in additionalTokens)"
        },
        "tokensRecipient": { "$ref": "#/$defs/Address" },
        "fundsRecipient": { "$ref": "#/$defs/Address" },
        "startOffsetBlocks": { "type": "integer", "minimum": 0 },
        "auctionDurationBlocks": { "type": "integer", "minimum": 1 },
        "claimDelayBlocks": { "type": "integer", "minimum": 0 },
        "graduationThresholdMps": { "$ref": "#/$defs/U256" },
        "tickSpacing": { "type": "integer", "minimum": 1 },
        "validationHook": { "$ref": "#/$defs/Address" },
        "floorPrice": { "$ref": "#/$defs/U256" }
      }
    },
    "additionalTokens": {
      "type": "array",
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": ["name", "decimals", "totalSupply", "percentAuctioned"],
        "properties": {
          "name": { "type": "string", "minLength": 1 },
          "decimals": { "$ref": "#/$defs/U64" },
          "totalSupply": { "$ref": "#/$defs/U256" },
          "percentAuctioned": { "type": "string", "pattern": "^[0-9]+(\\.[0-9]+)?$" }
        }
      },
      "minItems": 1,
      "description": "Array of tokens to deploy for the test"
    }
  },
  "$defs": {
    "Address": { "type": "string", "pattern": "^0x[0-9a-fA-F]{40}$" },
    "U64": { "type": "string", "pattern": "^[0-9]+$" },
    "U256": { "type": "string", "pattern": "^[0-9]+$" },
    "BalanceItem": {
      "type": "object",
      "additionalProperties": false,
      "required": ["address", "token", "amount"],
      "properties": {
        "address": { "$ref": "#/$defs/Address" },
        "token": {
          "oneOf": [
            { "$ref": "#/$defs/Address" },
            { "type": "string", "const": "Native" },
            { "type": "string", "minLength": 1, "pattern": "^[A-Za-z][A-Za-z0-9_]*$", "not": { "const": "Native" } }
          ],
          "description": "Either an address, 'Native' for native currency (ETH, MATIC, BNB, etc.), or a token name reference (e.g., 'USDC', 'SimpleToken')"
        },
        "amount": { "$ref": "#/$defs/U256" }
      }
    }
  }
}